name: call-center
eventTriggers:
  - name: create
    source: /callcenter
    type: org.kogito.examples.callcenter.create
  - name: resolve
    source: /callcenter
    type: org.kogito.examples.callcenter.resolve
    correlationToken: $.id
  - name: escalate
    source: /callcenter
    type: org.kogito.examples.callcenter.escalate
    correlationToken: $.id
  - name: resolve-escalation
    source: /callcenter
    type: org.kogito.examples.callcenter.resolve-escalation
    correlationToken: $.id
startAt: created
states:
  - name: created
    type: EVENT
    events:
      - event: create
        nextState: open
  - name: open
    type: OPERATION
    actionMode: SEQUENTIAL
    filter:
      inputPath: $.subject
      resultPath: $
      outputPath: $.assignee
    actions:
      - function:
          name: find-candidate
          type: aws
          parameters:
            name: arn:aws:lambda:REGION:ACCOUNT_ID:function:search-candidate
    nextState: assigned
  - name: assigned
    type: EVENT
    events:
      - event: resolve
        nextState: closed
        timeout:
          period: P1D
          then: manage-escalation
      - event: escalate
        nextState: manage-escalation
  - name: manage-escalation
    type: OPERATION
    filter:
      inputPath: $.subject
      resultPath: $
      outputPath: $.escalationManager
    actionMode: SEQUENTIAL
    actions:
      - function:
          name: find-escalation-manager
          type: aws
          parameters:
            function: arn:aws:lambda:REGION:ACCOUNT_ID:function:search-escalation-manager
    nextState: escalated
  - name: escalated
    type: EVENT
    events:
      - event: resolve-escalation
        nextState: closed
  - name: closed
    type: OPERATION
    actionMode: SEQUENTIAL
    actions:
      - function:
          name: notify-resolution
          type: notification
          parameters:
            recipient: $.requester
            caseNumber: $.id
            resolution: $.resolution
    end: true